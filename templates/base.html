<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}–ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–º–∞{% endblock %}</title>
    <link id="theme-style" rel="stylesheet" href="/static/css/style.css">
</head>

<body class="page">
    <a href="#main-content" class="skip-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É</a>
<header>
    <div class="container header-inner">
        <div class="logo">HomeStore</div>
            <nav class="header-nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</a>
                <a href="/delivery">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
                <a href="/sales">–ê–∫—Ü–∏–∏</a>
                <a href="/about">–û –∫–æ–º–ø–∞–Ω–∏–∏</a>
                <a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                <a href="/sitemap">–ö–∞—Ä—Ç–∞ —Å–∞–π—Ç–∞</a>
            </nav>
            <div class="header-right">
                <a href="/cart" class="cart-link" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">üõí{% if session.cart %}<span class="cart-badge">{{ session.cart | length }}</span>
            {% endif %}
                </a>
                {% if session.get("user") %}
                    <span class="user-name">–í—ã: {{ session.user.username }}</span>
                    <a href="/logout" class="header-link">–í—ã—Ö–æ–¥</a>
                {% else %}
                    <a href="/login" class="header-link">–í—Ö–æ–¥</a>
                {% endif %}
                <nav class="accessibility-nav" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                <div class="vision-toggle" role="region" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–µ—Ä—Å–∏–∏ –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö">
                    <span id="vision-label" class="vision-label">–û–±—ã—á–Ω–∞—è –≤–µ—Ä—Å–∏—è</span>

                    <label class="switch" title="–í–∫–ª—é—á–∏—Ç—å –≤–µ—Ä—Å–∏—é –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö">
                    <input
                        type="checkbox"
                        id="vision-mode-toggle"
                        role="switch"
                        aria-checked="false"
                        aria-labelledby="vision-label"
                    >
                    <span class="slider" aria-hidden="true"></span>
                    </label>
                </div>
                </nav>
            </div>  
        </div>
</header>
{% if session.get("user") %}
<nav class="subnav">
    <div class="subnav-inner">
        {% if session.user.role == "customer" %}
            <a href="/orders">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
            <a href="/messages">–°–æ–æ–±—â–µ–Ω–∏—è{% if new_messages %}<span class="badge">{{ new_messages }}</span>{% endif %}</a>
        {% endif %}
        {% if session.user.role == "admin" %}
            <a href="/admin">–ó–∞–∫–∞–∑—ã{% if new_orders %}<span class="badge">{{ new_orders }}</span>{% endif %}</a> 
            <a href="/admin/messages">–°–æ–æ–±—â–µ–Ω–∏—è{% if new_messages %}<span class="badge">{{ new_messages }}</span>{% endif %}</a>
        {% endif %}
    </div>
</nav>
{% endif %}
<main id="main-content" class="page-content">
    <div class="container">
        {% if not session.user or session.user.role != 'admin' %}
            <form action="/search" method="get" class="catalog-search">
                <input
                    type="text"
                    name="q"
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É"
                    value="{{ request.args.get('q', '') }}"
                    required>
                <button class="btn">–ù–∞–π—Ç–∏</button>
            </form>
        {% endif %}
    </div>
    {% block content %}{% endblock %}
</main>

<footer>
    <div class="container">
        <div class="footer-col">¬© 2025 –°–µ—Ç—å –º–∞–≥–∞–∑–∏–Ω–æ–≤ HomeStore</div>
        <div class="footer-col">–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</div>
    </div>
</footer>
<!--–ë–∞–Ω–Ω–µ—Ä—ã-->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const slides = document.querySelectorAll(".slide");
    const dotsContainer = document.querySelector(".slider-dots");
    const prevBtn = document.querySelector(".slider-arrow.prev");
    const nextBtn = document.querySelector(".slider-arrow.next");
    let current = 0;
    let timer;

    slides.forEach((slide, i) => {
        slide.style.backgroundImage = `url(${slide.dataset.bg})`;

        const dot = document.createElement("div");
        dot.className = "slider-dot" + (i === 0 ? " active" : "");
        dot.addEventListener("click", () => goTo(i));
        dotsContainer.appendChild(dot);
    });

    const dots = document.querySelectorAll(".slider-dot");

    function goTo(index) {
        slides[current].classList.remove("active");
        dots[current].classList.remove("active");

        current = index;

        slides[current].classList.add("active");
        dots[current].classList.add("active");
        resetTimer();
    }

    function next() {
        goTo((current + 1) % slides.length);
    }

    function prev() {
        goTo((current - 1 + slides.length) % slides.length);
    }

    function resetTimer() {
        clearInterval(timer);
        timer = setInterval(next, 5000);
    }

    nextBtn.addEventListener("click", next);
    prevBtn.addEventListener("click", prev);

    timer = setInterval(next, 5000);
});
</script>
<!--–≤–µ—Ä—Å–∏—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö-->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const checkbox = document.getElementById("vision-mode-toggle");
  const label = document.getElementById("vision-label");
  const themeLink = document.getElementById("theme-style");

  if (!checkbox || !themeLink || !label) return;

  // –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–∑–Ω–∞—á–µ–Ω–∏—è: "on" / "off")
  const saved = localStorage.getItem("vision-mode");

  const applyMode = (on) => {
    if (on) {
      themeLink.setAttribute("href", "/static/css/vision.css");
      checkbox.checked = true;
      checkbox.setAttribute("aria-checked", "true");
      label.textContent = "–í–µ—Ä—Å–∏—è –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö";
    } else {
      themeLink.setAttribute("href", "/static/css/style.css");
      checkbox.checked = false;
      checkbox.setAttribute("aria-checked", "false");
      label.textContent = "–û–±—ã—á–Ω–∞—è –≤–µ—Ä—Å–∏—è";
    }
  };

  // –ø—Ä–∏–º–∏–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
  applyMode(saved === "on");

  // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  checkbox.addEventListener("change", () => {
    const on = checkbox.checked;
    applyMode(on);
    localStorage.setItem("vision-mode", on ? "on" : "off");
  });

});
</script>
<!--–∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –µ—â–µ-->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("show-more-news");
  if (!btn) return;

  btn.addEventListener("click", () => {
    document.querySelectorAll(".news-hidden").forEach(el => {
      el.classList.remove("news-hidden");
    });
    btn.remove();
  });
});
</script>
<!--—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å –≤ –¥–∏–∞–ª–æ–≥–∞—Ö-->
<script>
document.addEventListener("click", function (e) {
  const btn = e.target.closest(".dialog-toggle");
  if (!btn) return;

  e.preventDefault();

  const id = btn.getAttribute("data-dialog");
  if (!id) return;

  const body = document.getElementById("dialog-" + id);
  if (!body) return;

  body.classList.toggle("news-hidden");

  btn.textContent = body.classList.contains("news-hidden")
    ? "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"
    : "–°–≤–µ—Ä–Ω—É—Ç—å";
});
</script>

</body>
</html>